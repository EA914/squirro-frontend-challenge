<!DOCTYPE html>
<html>
  <head>
    <title>Book Store Website</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
      }

      .store {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
        position: relative;
      }

      .store-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
        /* Make the image circular */
        margin-bottom: 10px;
      }

      .store-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .store-info a {
        text-decoration: none;
        color: #333;
      }

      .store-info a:hover {
        text-decoration: underline;
      }

      .establishment-date {
        position: absolute;
        bottom: 1px;
        left: 5px;
        font-size: 15px;
        color: #666;
        font-style: bold;
      }

      .rating {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        position: absolute;
        top: 5px;
        right: 5px;
      }

      .star {
        width: 20px;
        height: 20px;
        margin-right: 2px;
      }

      .books {
        margin-top: 10px;
      }

      .book {
        margin-bottom: 5px;
      }

      .flag {
        width: 30px;
        height: 20px;
        position: absolute;
        bottom: 5px;
        right: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container" id="storeContainer"></div>
    <script>
      async function fetchStores() {
        const response = await fetch('http://localhost:3000/stores');
        const data = await response.json();
        const stores = data.data;
        const storeContainer = document.getElementById('storeContainer');
        stores.forEach(store => {
          const storeAttributes = store.attributes;
          const storeCountries = data.included.find(inc => inc.type === 'countries' && inc.id === store.relationships.countries.data.id).attributes;
          const storeBooks = store.relationships.books.data.map(book => {
            return data.included.find(inc => inc.type === 'books' && inc.id === book.id).attributes;
          });
          const storeElement = document.createElement('div');
          storeElement.classList.add('store');
          const storeImage = document.createElement('img');
          storeImage.classList.add('store-image');
          storeImage.src = storeAttributes.storeImage;
          storeImage.alt = storeAttributes.name;
          const storeInfo = document.createElement('div');
          storeInfo.classList.add('store-info');
          const storeName = document.createElement('h3');
          storeName.textContent = storeAttributes.name;
          const rating = document.createElement('div');
          rating.classList.add('rating');
          for (let i = 0; i < storeAttributes.rating; i++) {
            const star = document.createElement('span');
            star.classList.add('star');
            star.textContent = 'â˜…';
            rating.appendChild(star);
          }
          const establishmentDate = document.createElement('p');
          const date = new Date(storeAttributes.establishmentDate);
          const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()}`;
          const website = storeAttributes.website.replace(/^https?:\/\//, ''); // Remove "https://" or "http://"
          establishmentDate.innerHTML = `${formattedDate} - 
			<a href="http://${storeAttributes.website}" target="_blank">${website}</a>`;
          establishmentDate.classList.add('establishment-date');
          const flag = document.createElement('img');
          flag.classList.add('flag');
          flag.src = `https://flagsapi.com/${storeCountries.code}/flat/64.png`;
          flag.alt = storeCountries.code;
          const books = document.createElement('div');
          books.classList.add('books');
          const topBooksTitle = document.createElement('h4');
          topBooksTitle.textContent = 'Top Books:';
          const booksList = document.createElement('ul');
          storeBooks.slice(0, 2).forEach(book => {
            const bookItem = document.createElement('li');
            bookItem.textContent = `${book.name} - ${book.copiesSold} copies sold`;
            booksList.appendChild(bookItem);
          });
          if (storeBooks.length === 0) {
            const noDataAvailable = document.createElement('p');
            noDataAvailable.textContent = 'No data available';
            books.appendChild(noDataAvailable);
          } else {
            books.appendChild(topBooksTitle);
            books.appendChild(booksList);
          }
          storeInfo.appendChild(storeName);
          storeInfo.appendChild(rating);
          storeInfo.appendChild(establishmentDate);
          storeInfo.appendChild(flag);
          storeElement.appendChild(storeImage);
          storeElement.appendChild(storeInfo);
          storeElement.appendChild(books);
          storeContainer.appendChild(storeElement);
        });
      }
      fetchStores();
    </script>
  </body>
</html>